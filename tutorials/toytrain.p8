pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	cls()
	switch_state=0
	train={
		{64,8},
		{72,8},
		{80,8}
	}
end

function move_segment(s,dir)
	spd=dir*2
	if(s[2]==8)--topside
	then
		if(s[1]==112)--top right
		then
			s[2]+=spd
		else
			s[1]+=spd
		end
	else
		if(s[1]==112)--right side
		then
			if(s[2]==112)--bottom right
			then
				s[1]-=spd
			else
				s[2]+=spd
			end
		else
			if(s[2]==112)--bottom side
			then
				if(s[1]==8)--bottom side
				then
					s[2]-=spd
				else
					s[1]-=spd
				end
			else
				if(s[1]==8)--left side
				then
					if(s[2]==8)--top left
					then
						s[1]+=spd
					else
						s[2]-=spd
					end
				end
			end
		end
	end
end

function adv_switch()
	if(switch_state<1)
	then
		switch_state+=1
	else
		switch_state=0
	end
end

function move_train()
	for t in all(train)
	do
		move_segment(t,switch_state)
	end
end

function _update()
	if(btnp(4))
	then
		adv_switch()
	end
	move_train()
end

function draw_train()
	local len=count(train)
	for t=1,len
	do
		if(t==1)
		then
			sprite=11
		else
			if(t==len)
			then
				sprite=13
			else
				sprite=12
			end
		end
		spr(sprite,train[t][1],train[t][2])
	end
end

function draw_switch()
	if(switch_state==1)
	then
		sspr(0,16,16,16,56,56,16,16)
	else
		sspr(64,16,16,16,56,56,16,16)
	end
end

function _draw()
	map(0,0,0,0,16,16)
	draw_switch()
	draw_train()
end
__gfx__
00000000000000004444444444445444444444444444444444444444667666560dddddd00dddddd00dddddd00dddddd00dddddd00dddddd00000000000000000
0000000000000000454444444444544446666666666666666666666465666666dd5dd5d0dd5dd5dd0d5dd5ddd555555dd555555dd555555d0000000000000000
0070070000000000454444444444554446555555555555555555556466666666dd5dd5d0dd5dd5dd0d5dd5ddd5dddd5dd5dddd5dd5dddd5d0000000000000000
0007700000000000455444444444454446566466466646664664656466666766dd5665606d5665d6065665ddd5dddd5dd5d55d5dd5d11d5d0000000000000000
0007700000000000445444454444455546546466466646664646656466666656dd5665606d5665d6065665ddd5dddd5dd5d55d5dd5d11d5d0000000000000000
0070070000000000445444455444444446564555555555555554456466666666dd5dd5d0dd5dd5dd0d5dd5ddd5dddd5dd5dddd5dd5dddd5d0000000000000000
0000000000000000444444445444444446566566666666666656656465666666dd5dd5d0dd5dd5dd0d5dd5ddd555555dd555555dd555555d0000000000000000
00000000000000004544444454444444465445644444444446566564666666670dddddd00dddddd00dddddd00dddddd00dddddd00dddddd00000000000000000
00000000000000004444444544444454465665644888844446544564444888840dddddd00dd66dd0000000000000000000000000000000000000000000000000
0000000000000000444444454444444446566564448778444656656444877844ddddddddddddddddddd66ddd0000000000000000000000000000000000000000
0000000000000000444444544444454446566564444877844656656448778444d555555dd555555dd555555d0000000000000000000000000000000000000000
0000000000000000444444544444554446544564444487784656656487784444ddd66dddddd66dddddd66ddd0000000000000000000000000000000000000000
0000000000000000444445544455544446566564444487784654456487784444ddd66dddddd66dddddd66ddd0000000000000000000000000000000000000000
0000000000000000444445444554444446566564444877844656656448778444d555555dd555555dd555555d0000000000000000000000000000000000000000
0000000000000000444455444544444446566564448778444656656444877844ddd66ddddddddddddddddddd0000000000000000000000000000000000000000
0000000000000000444454444544444446544564488884444656656444488884000000000dd66dd00dddddd00000000000000000000000000000000000000000
0000055555500000000005555550000046566564444444444654456466766656000005dddd500000000000000000000000000000000000000000000000000000
0005555555555000000555555555500046566566666666666656656469959996000555d77d555000000000000000000000000000000000000000000000000000
00555555555ddd000055555555555500465445555555555555546564699959960055557777555500000000000000000000000000000000000000000000000000
0555555555777d50055555555555555046566464666466646646456469555596055555dddd555550000000000000000000000000000000000000000000000000
055555555dd77d50055555555555555046564664666466646646656469555596055555dddd555550000000000000000000000000000000000000000000000000
55555555dddd7555555555555555555546555555555555555555556469995996555555dddd555555000000000000000000000000000000000000000000000000
5555555ddddd5555ddddddddddddd7dd46666666666666666666666469959996555555dddd555555000000000000000000000000000000000000000000000000
555555ddddd55555ddddddddddddd77d44444444444444444444444466666667555555dddd555555000000000000000000000000000000000000000000000000
55555ddddd555555ddddddddddddd77d66566676665666766667667666566676555555dddd555555000000000000000000000000000000000000000000000000
5555ddddd5555555ddddddddddddd7dd66666995999666666666699559966666555555dddd555555000000000000000000000000000000000000000000000000
555ddddd55555555555555555555555567666999599666666566695995966666555555dddd555555000000000000000000000000000000000000000000000000
05ddddd555555550055555555555555066656955559666566666659959566566055555dddd555550000000000000000000000000000000000000000000000000
05dddd5555555550055555555555555066666955559666666666659599566666055555dddd555550000000000000000000000000000000000000000000000000
00ddd55555555500005555555555550056666999599666666656695995966676005555dddd555500000000000000000000000000000000000000000000000000
0005555555555000000555555555500066666995999666655666699559966665000555dddd555000000000000000000000000000000000000000000000000000
0000055555500000000005555550000066676666666566666667666666676666000005dddd500000000000000000000000000000000000000000000000000000
__map__
0203020302030203020302030203020300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1204050505050505050505050505061300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030736372702030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312130707070712131215161700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030707070702030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312130707070712131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0214020302030203020302030203160300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1214121312131213121312131213161300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0224252525252525252525252525260300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1213121312131213121312131213121300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
